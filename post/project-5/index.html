<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Project 5: Predicting Energy Price. ML | Oriol</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Using Advanced Data Featuring (Python) to build a model that predicts the day-ahead price of power in Spain.">
    <meta name="generator" content="Hugo 0.80.0" />
    
    
      <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
    

    

  
  
    <link rel="stylesheet" href="https://oriolvila.github.io/Oriol_Portfolio/ananke/dist/main.css_5c99d70a7725bacd4c701e995b969fea.css" >
  




    
      

    

    
    
    <meta property="og:title" content="Project 5: Predicting Energy Price. ML" />
<meta property="og:description" content="Using Advanced Data Featuring (Python) to build a model that predicts the day-ahead price of power in Spain." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://oriolvila.github.io/Oriol_Portfolio/post/project-5/" />
<meta property="article:published_time" content="2021-03-10T11:00:59-04:00" />
<meta property="article:modified_time" content="2021-03-10T11:00:59-04:00" /><meta property="og:site_name" content="Oriol" />
<meta itemprop="name" content="Project 5: Predicting Energy Price. ML">
<meta itemprop="description" content="Using Advanced Data Featuring (Python) to build a model that predicts the day-ahead price of power in Spain.">
<meta itemprop="datePublished" content="2021-03-10T11:00:59-04:00" />
<meta itemprop="dateModified" content="2021-03-10T11:00:59-04:00" />
<meta itemprop="wordCount" content="1254">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Project 5: Predicting Energy Price. ML"/>
<meta name="twitter:description" content="Using Advanced Data Featuring (Python) to build a model that predicts the day-ahead price of power in Spain."/>

	
  </head>

  <body class="ma0 avenir bg-near-white">

    
   
  

  
  
  <header class="cover bg-top" style="background-image: url('https://oriolvila.github.io/Oriol_Portfolio/images/Project5.jpg');">
    <div class="pb3-m pb6-l bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://oriolvila.github.io/Oriol_Portfolio/" class="f3 fw2 hover-white no-underline white-90 dib">
      
        Oriol
      
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://oriolvila.github.io/Oriol_Portfolio/about/" title="About page">
              About
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://oriolvila.github.io/Oriol_Portfolio/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="https://oriolvila.github.io/Oriol_Portfolio/post/" title="Projects page">
              Projects
            </a>
          </li>
          
        </ul>
      
      




<a href="https://twitter.com/Oriol_VilaMasip" target="_blank" class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel="noopener" aria-label="follow on Twitter——Opens in a new window">
  <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>




<a href="https://www.linkedin.com/in/oriol-vila-masip/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/OriolVila" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>








    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <h1 class="f2 f1-l fw2 white-90 mb0 lh-title">Project 5: Predicting Energy Price. ML</h1>
          
            <h2 class="fw1 f5 f3-l white-80 measure-wide-l center lh-copy mt3 mb4">
              Using Advanced Data Featuring (Python) to build a model that predicts the day-ahead price of power in Spain.
            </h2>
          
        
      </div>
    </div>
  </header>



    <main class="pb7" role="main">
      
  
  <article class="flex-l flex-wrap justify-between mw8 center ph3">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked">
          
        PROJECTS
      </aside>
      




  <div id="sharing" class="mt3">

    
    <a href="https://www.facebook.com/sharer.php?u=https://oriolvila.github.io/Oriol_Portfolio/post/project-5/" class="facebook no-underline" aria-label="share on Facebook">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M28.765,50.32h6.744V33.998h4.499l0.596-5.624h-5.095  l0.007-2.816c0-1.466,0.14-2.253,2.244-2.253h2.812V17.68h-4.5c-5.405,0-7.307,2.729-7.307,7.317v3.377h-3.369v5.625h3.369V50.32z   M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;"/></svg>

    </a>

    
    
    <a href="https://twitter.com/share?url=https://oriolvila.github.io/Oriol_Portfolio/post/project-5/&amp;text=Project%205:%20Predicting%20Energy%20Price.%20ML" class="twitter no-underline" aria-label="share on Twitter">
      <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

    </a>

    
    <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://oriolvila.github.io/Oriol_Portfolio/post/project-5/&amp;title=Project%205:%20Predicting%20Energy%20Price.%20ML" class="linkedin no-underline" aria-label="share on LinkedIn">
      <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

    </a>
  </div>


      <h1 class="f1 athelas mt3 mb1">Project 5: Predicting Energy Price. ML</h1>
      
      
      <time class="f6 mv4 dib tracked" datetime="2021-03-10T11:00:59-04:00">March 10, 2021</time>

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links nested-img mid-gray pr4-l w-two-thirds-l"><p>In this ML project we will create a model that predicts the day-ahead price of power in Spain with Python.</p>
<p>As in previous projects, we will cover some of the most interesting steps and findings but not all of them. Personally, I would recommend that you download the code (Jupyter notebook) and the datasets (CSV files) for a better understanding.</p>
<p>Our dataset (power_market.csv) is composed of:</p>
<ul>
<li>date: date of the observation ”%Y-%m-%d”</li>
<li>hour: hour of the observation, [0 - 23]</li>
<li>fc demand: forecast of demand in MWh</li>
<li>fc nuclear: forecast of nuclear power production in MWh</li>
<li>import FR: forecast of the importing capacity from France to Spain in MWh</li>
<li>export FR: forecast of the exporting capacity from Spain to France in MWh</li>
<li>fc wind: forecast of wind power production in MWh</li>
<li>fc solar pv: forecast of PV solar (solar panels) power production in MWh</li>
<li>fc solar th: forecast of thermal solar power production in MWh</li>
<li>price: power price for each hour in €/MWh. This is the target we want you to predict.
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_1.PNG"/> 
</figure>

And the scoring.csv:
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_2.PNG"/> 
</figure>
</li>
</ul>
<p>We start off by importing the libraries we need. As well as the common machine learning libraries (<em>sklearn, pandas, numpy</em>, etc) we use <em>astral</em> to calculate sunrise and sunset times, and <em>xgboost</em> to use their gradient boosting regressor.</p>
<p><strong>Exploratory Data Analysis</strong></p>
<p>We create the function &ldquo;ESHolidayCalendar&rdquo; to check whether or not certain days are a holiday in Spain.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"> <span style="color:#a6e22e">class</span> <span style="color:#a6e22e">ESHolidayCalendar</span>(<span style="color:#a6e22e">AbstractHolidayCalendar</span>):
 <span style="color:#a6e22e">rules</span> = [
     <span style="color:#a6e22e">Holiday</span>(<span style="color:#e6db74">&#34;New Years Day&#34;</span>, <span style="color:#a6e22e">month</span>=<span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">day</span>=<span style="color:#ae81ff">1</span>),
     <span style="color:#a6e22e">GoodFriday</span>,
     <span style="color:#a6e22e">Holiday</span>(<span style="color:#e6db74">&#34;Labor Day&#34;</span>, <span style="color:#a6e22e">month</span>=<span style="color:#ae81ff">5</span>, <span style="color:#a6e22e">day</span>=<span style="color:#ae81ff">1</span>),
     <span style="color:#a6e22e">Holiday</span>(<span style="color:#e6db74">&#34;Spain Day&#34;</span>, <span style="color:#a6e22e">month</span>=<span style="color:#ae81ff">10</span>, <span style="color:#a6e22e">day</span>=<span style="color:#ae81ff">12</span>),
     <span style="color:#a6e22e">Holiday</span>(<span style="color:#e6db74">&#34;All Saints Day&#34;</span>, <span style="color:#a6e22e">month</span>=<span style="color:#ae81ff">11</span>, <span style="color:#a6e22e">day</span>=<span style="color:#ae81ff">1</span>),
     <span style="color:#a6e22e">Holiday</span>(<span style="color:#e6db74">&#34;Consitution Day&#34;</span>, <span style="color:#a6e22e">month</span>=<span style="color:#ae81ff">12</span>, <span style="color:#a6e22e">day</span>=<span style="color:#ae81ff">6</span>),
     <span style="color:#a6e22e">Holiday</span>(<span style="color:#e6db74">&#34;Inmaculada Concepcion&#34;</span>, <span style="color:#a6e22e">month</span>=<span style="color:#ae81ff">12</span>, <span style="color:#a6e22e">day</span>=<span style="color:#ae81ff">8</span>),
     <span style="color:#a6e22e">Holiday</span>(<span style="color:#e6db74">&#34;Christmas&#34;</span>, <span style="color:#a6e22e">month</span>=<span style="color:#ae81ff">12</span>, <span style="color:#a6e22e">day</span>=<span style="color:#ae81ff">25</span>),
 ]
<span style="color:#a6e22e">spain_calendar</span> = <span style="color:#a6e22e">CustomBusinessDay</span>(<span style="color:#a6e22e">calendar</span>=<span style="color:#a6e22e">ESHolidayCalendar</span>(), <span style="color:#a6e22e">weekmask</span>=<span style="color:#e6db74">&#34;Mon Tue Wed Thu Fri Sat Sun&#34;</span>)
</code></pre></div></p>
<p>We detected that there are 26 null values in our dataframe (<em>df.isnull().sum()</em>). We plot a correlation matrix to make sure that our missing values are not correlated.
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_3.PNG"/> 
</figure>
</p>
<p>We can also detect some patterns with visualizations.
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_4.PNG"/> <figcaption>
            <h4>Demand by hour and month</h4>
        </figcaption>
</figure>

<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_5.PNG"/> <figcaption>
            <h4>Price by hour and month</h4>
        </figcaption>
</figure>
</p>
<p><strong>Feature Engineering</strong></p>
<p>This <em>DateEncoder</em> is a result of our iterative feature engineering process. As we discovered new patterns in the data we added more features. It works in the same way as <em>FunctionTransformers</em>, so it can be included as a step in a pipeline, and its parameters can be changed so it behaves differently (include some features or not). This allows for clean pipelines, and prevents us from having to make copies of dataframes for every type of preprocessing we want to do.</p>
<p>These are the features it can extract:</p>
<ul>
<li>season, which can be returned as a column of strings or as a series of encoded columns</li>
<li>is_holiday, whether or not it is a holiday in Spain</li>
<li>is_weekend</li>
<li>is_business_day, the combination of the two previous features</li>
<li>sunlight, hours of sunlight</li>
<li>sun, whether or not the sun is up at any given hour (rounds to the nearest hour)</li>
<li>t_from_zenith, the hours away from the sun&rsquo;s zenith</li>
<li>day_period, the period of the day
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">class</span> <span style="color:#a6e22e">DateEncoder</span>(<span style="color:#a6e22e">TransformerMixin</span>, <span style="color:#a6e22e">BaseEstimator</span>):
    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">__init__</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">date_feature_name</span>=<span style="color:#e6db74">&#34;date&#34;</span>, <span style="color:#a6e22e">hour_feature_name</span>=<span style="color:#e6db74">&#34;hour&#34;</span>, <span style="color:#a6e22e">drop_date_col</span>=<span style="color:#a6e22e">True</span>, <span style="color:#a6e22e">drop_hour_col</span>=<span style="color:#a6e22e">True</span>, <span style="color:#a6e22e">ohe_cats</span>=<span style="color:#a6e22e">True</span>):
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">date_feature_name</span> = <span style="color:#a6e22e">date_feature_name</span>
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span> = <span style="color:#a6e22e">hour_feature_name</span>
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">drop_date_col</span> = <span style="color:#a6e22e">drop_date_col</span>
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">drop_hour_col</span> = <span style="color:#a6e22e">drop_hour_col</span>
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">ohe_cats</span> = <span style="color:#a6e22e">ohe_cats</span>

    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">X</span>, <span style="color:#a6e22e">y</span>=<span style="color:#a6e22e">None</span>):
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">self</span>

    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">create_sun_items</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">date_series</span>, <span style="color:#a6e22e">city</span>=<span style="color:#e6db74">&#34;Madrid&#34;</span>, <span style="color:#a6e22e">region</span>=<span style="color:#e6db74">&#34;Spain&#34;</span>, <span style="color:#a6e22e">timezone</span>=<span style="color:#e6db74">&#34;Europe/Madrid&#34;</span>, <span style="color:#a6e22e">latitude</span>=<span style="color:#ae81ff">40.4168</span>, <span style="color:#a6e22e">longitude</span>=<span style="color:#ae81ff">3.7038</span>):
        <span style="color:#a6e22e">city</span> = <span style="color:#a6e22e">LocationInfo</span>(<span style="color:#a6e22e">city</span>, <span style="color:#a6e22e">region</span>, <span style="color:#a6e22e">timezone</span>, <span style="color:#a6e22e">latitude</span>, <span style="color:#a6e22e">longitude</span>)
        <span style="color:#a6e22e">s</span> = <span style="color:#a6e22e">date_series</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#a6e22e">lambda</span> <span style="color:#a6e22e">x</span>: <span style="color:#a6e22e">sun</span>.<span style="color:#a6e22e">sun</span>(<span style="color:#a6e22e">city</span>.<span style="color:#a6e22e">observer</span>, <span style="color:#a6e22e">date</span>=<span style="color:#a6e22e">x</span>, <span style="color:#a6e22e">tzinfo</span>=<span style="color:#a6e22e">city</span>.<span style="color:#a6e22e">timezone</span>))
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">sun_items</span> = <span style="color:#a6e22e">s</span>

    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">transform</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">X</span>):
        <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">X</span>.copy()

        <span style="color:#a6e22e">month</span> = <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">date_feature_name</span>].<span style="color:#a6e22e">dt</span>.<span style="color:#a6e22e">month</span>
        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;season&#34;</span>] = <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">where</span>(
            <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_or</span>(<span style="color:#a6e22e">month</span> &lt; <span style="color:#ae81ff">3</span>, <span style="color:#a6e22e">month</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">12</span>),
            <span style="color:#e6db74">&#34;winter&#34;</span>,
            <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">where</span>(<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_and</span>(<span style="color:#a6e22e">month</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">3</span>, <span style="color:#a6e22e">month</span> &lt; <span style="color:#ae81ff">6</span>), <span style="color:#e6db74">&#34;spring&#34;</span>, <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">where</span>(<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_and</span>(<span style="color:#a6e22e">month</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">6</span>, <span style="color:#a6e22e">month</span> &lt; <span style="color:#ae81ff">9</span>), <span style="color:#e6db74">&#34;summer&#34;</span>, <span style="color:#e6db74">&#34;autumn&#34;</span>)),
        )



        <span style="color:#a6e22e">start_date</span> = <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">date_feature_name</span>].<span style="color:#a6e22e">min</span>()
        <span style="color:#a6e22e">end_date</span> = <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">date_feature_name</span>].<span style="color:#a6e22e">max</span>()
        <span style="color:#a6e22e">date_range</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">bdate_range</span>(<span style="color:#a6e22e">start_date</span>, <span style="color:#a6e22e">end_date</span>, <span style="color:#a6e22e">freq</span>=<span style="color:#a6e22e">spain_calendar</span>)
        <span style="color:#a6e22e">holiday</span> = <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">date_feature_name</span>].<span style="color:#a6e22e">isin</span>(<span style="color:#a6e22e">date_range</span>)
        <span style="color:#a6e22e">holiday</span> = <span style="color:#960050;background-color:#1e0010">~</span><span style="color:#a6e22e">holiday</span>
        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;is_holiday&#34;</span>] = <span style="color:#a6e22e">holiday</span>.<span style="color:#a6e22e">astype</span>(<span style="color:#66d9ef">int</span>)

        <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">TODO</span>: <span style="color:#a6e22e">morning</span> <span style="color:#a6e22e">vs</span> <span style="color:#a6e22e">midday</span> <span style="color:#a6e22e">vs</span> <span style="color:#a6e22e">evening</span>

        <span style="color:#a6e22e">hour_cats_enc</span> = <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">where</span>(
            <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_and</span>(
                <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">0</span>,
                <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] &lt; <span style="color:#ae81ff">6</span>,
            ),
            <span style="color:#e6db74">&#34;night&#34;</span>,
            <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">where</span>(
                <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_and</span>(<span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">6</span>, <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] &lt; <span style="color:#ae81ff">11</span>),
                <span style="color:#e6db74">&#34;morning&#34;</span>,
                <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">where</span>(
                    <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_and</span>(<span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">11</span>, <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] &lt; <span style="color:#ae81ff">18</span>),
                    <span style="color:#e6db74">&#34;day&#34;</span>,
                    <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">where</span>(
                        <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_and</span>(<span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">18</span>, <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] &lt; <span style="color:#ae81ff">22</span>),
                        <span style="color:#e6db74">&#34;evening&#34;</span>,
                        <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">where</span>(<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_and</span>(<span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">22</span>, <span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] &lt; <span style="color:#ae81ff">24</span>), <span style="color:#e6db74">&#34;night&#34;</span>, <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">nan</span>),
                    ),
                ),
            ),
        )

        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;day_period&#34;</span>] = <span style="color:#a6e22e">hour_cats_enc</span>

        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">create_sun_items</span>(<span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">date_feature_name</span>])
        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;sun_item&#34;</span>] = <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">sun_items</span>
        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;sunlight_s&#34;</span>] = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#a6e22e">lambda</span> <span style="color:#a6e22e">row</span>: (<span style="color:#a6e22e">row</span>[<span style="color:#e6db74">&#34;sun_item&#34;</span>][<span style="color:#e6db74">&#34;sunset&#34;</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">row</span>[<span style="color:#e6db74">&#34;sun_item&#34;</span>][<span style="color:#e6db74">&#34;dawn&#34;</span>]).<span style="color:#a6e22e">seconds</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)
        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;sun&#34;</span>] = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#a6e22e">lambda</span> <span style="color:#a6e22e">row</span>: <span style="color:#a6e22e">row</span>[<span style="color:#e6db74">&#34;sun_item&#34;</span>][<span style="color:#e6db74">&#34;sunrise&#34;</span>].<span style="color:#a6e22e">hour</span> &lt; <span style="color:#a6e22e">row</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>] &lt; <span style="color:#a6e22e">row</span>[<span style="color:#e6db74">&#34;sun_item&#34;</span>][<span style="color:#e6db74">&#34;sunset&#34;</span>].<span style="color:#a6e22e">hour</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>).<span style="color:#a6e22e">astype</span>(<span style="color:#66d9ef">int</span>)
        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;t_from_zenith&#34;</span>] = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">apply</span>(<span style="color:#a6e22e">lambda</span> <span style="color:#a6e22e">row</span>: <span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">abs</span>(<span style="color:#a6e22e">row</span>[<span style="color:#e6db74">&#34;sun_item&#34;</span>][<span style="color:#e6db74">&#34;noon&#34;</span>].<span style="color:#a6e22e">hour</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">row</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>]), <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)
        <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">drop</span>(<span style="color:#e6db74">&#34;sun_item&#34;</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)

        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;is_weekend&#34;</span>] = (<span style="color:#a6e22e">X_</span>[<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">date_feature_name</span>].<span style="color:#a6e22e">dt</span>.<span style="color:#a6e22e">dayofweek</span> <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">astype</span>(<span style="color:#66d9ef">int</span>)

        <span style="color:#a6e22e">business_day</span> = <span style="color:#960050;background-color:#1e0010">~</span><span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">logical_or</span>(<span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;is_holiday&#34;</span>], <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;is_weekend&#34;</span>])
        <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;is_business_day&#34;</span>] = <span style="color:#a6e22e">business_day</span>.<span style="color:#a6e22e">astype</span>(<span style="color:#66d9ef">int</span>)

        <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;time_of_day&#34;</span>]

        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">ohe_cats</span>:
            <span style="color:#a6e22e">ohe</span> = <span style="color:#a6e22e">OneHotEncoder</span>(<span style="color:#a6e22e">sparse</span>=<span style="color:#a6e22e">False</span>, <span style="color:#a6e22e">handle_unknown</span>=<span style="color:#e6db74">&#34;ignore&#34;</span>)
            <span style="color:#a6e22e">seasons_ohe</span> = <span style="color:#a6e22e">ohe</span>.<span style="color:#a6e22e">fit_transform</span>(<span style="color:#a6e22e">X_</span>[[<span style="color:#e6db74">&#34;season&#34;</span>]])
            <span style="color:#a6e22e">season_cols</span> = <span style="color:#a6e22e">ohe</span>.<span style="color:#a6e22e">get_feature_names</span>([<span style="color:#e6db74">&#34;season&#34;</span>])
            <span style="color:#a6e22e">seasons_ohe</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">DataFrame</span>(<span style="color:#a6e22e">seasons_ohe</span>, <span style="color:#a6e22e">columns</span>=<span style="color:#a6e22e">season_cols</span>)

            <span style="color:#a6e22e">dayperiod_ohe</span> = <span style="color:#a6e22e">ohe</span>.<span style="color:#a6e22e">fit_transform</span>(<span style="color:#a6e22e">X_</span>[[<span style="color:#e6db74">&#34;day_period&#34;</span>]])
            <span style="color:#a6e22e">dayperiod_cols</span> = <span style="color:#a6e22e">ohe</span>.<span style="color:#a6e22e">get_feature_names</span>([<span style="color:#e6db74">&#34;day_period&#34;</span>])
            <span style="color:#a6e22e">dayperiod_ohe</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">DataFrame</span>(<span style="color:#a6e22e">dayperiod_ohe</span>, <span style="color:#a6e22e">columns</span>=<span style="color:#a6e22e">dayperiod_cols</span>)


            <span style="color:#a6e22e">index</span> = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">index</span>
            <span style="color:#a6e22e">seasons_ohe</span>.<span style="color:#a6e22e">index</span> = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">index</span>
            <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">concat</span>([<span style="color:#a6e22e">X_</span>, <span style="color:#a6e22e">seasons_ohe</span>], <span style="color:#a6e22e">sort</span>=<span style="color:#a6e22e">False</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">ignore_index</span>=<span style="color:#a6e22e">True</span>, <span style="color:#a6e22e">join_axes</span>=[<span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">index</span>])
            <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">concat</span>([<span style="color:#a6e22e">X_</span>, <span style="color:#a6e22e">seasons_ohe</span>, <span style="color:#a6e22e">dayperiod_ohe</span>], <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)
            <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">index</span> = <span style="color:#a6e22e">index</span>
            <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">drop</span>(<span style="color:#e6db74">&#34;season&#34;</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)


        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">drop_date_col</span>:
            <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">drop</span>(<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">date_feature_name</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">drop_hour_col</span>:
            <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">drop</span>(<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">hour_feature_name</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)

        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">X_</span>
</code></pre></div>
This <em>EnergyEncoder</em> extracts ratios and differences between <em>fc_demand</em> and all the sources of production in our dataset.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">class</span> <span style="color:#a6e22e">EnergyEncoder</span>(<span style="color:#a6e22e">TransformerMixin</span>, <span style="color:#a6e22e">BaseEstimator</span>):
    <span style="color:#e6db74">&#34;&#34;&#34;A template for a custom transformer.&#34;&#34;&#34;</span>

    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">__init__</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">calculate_ratios</span>=<span style="color:#a6e22e">True</span>, <span style="color:#a6e22e">calculate_diffs</span>=<span style="color:#a6e22e">True</span>, <span style="color:#a6e22e">impute_imp_exp</span>=<span style="color:#a6e22e">True</span>):
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">calculate_ratios</span> = <span style="color:#a6e22e">calculate_ratios</span>
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">calculate_diffs</span> = <span style="color:#a6e22e">calculate_diffs</span>
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">impute_imp_exp</span> = <span style="color:#a6e22e">impute_imp_exp</span>

    <span style="color:#960050;background-color:#1e0010">#</span>     <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">generate_thermal_gap</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">df</span>):
    <span style="color:#960050;background-color:#1e0010">#</span>         <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">thermal_gap</span> = <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;fc_demand&#34;</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;fc_nuclear&#34;</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;fc_wind&#34;</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;fc_solar_pv&#34;</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">df</span>[<span style="color:#e6db74">&#34;fc_solar_th&#34;</span>]

    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">generate_ratios</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">df</span>, <span style="color:#a6e22e">numerators</span>, <span style="color:#a6e22e">denominators</span>=[<span style="color:#e6db74">&#34;fc_demand&#34;</span>]):
        <span style="color:#a6e22e">ratios</span> = {}
        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">denominator</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">denominators</span>:
            <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">numerator</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">numerators</span>:
                <span style="color:#a6e22e">ratios</span>[<span style="color:#a6e22e">f</span><span style="color:#e6db74">&#34;{numerator}/{denominator}&#34;</span>] = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">numerator</span>] <span style="color:#f92672">/</span> <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">denominator</span>]
            <span style="color:#a6e22e">ratios</span>[<span style="color:#a6e22e">f</span><span style="color:#e6db74">&#34;total/{denominator}&#34;</span>] = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">numerator</span>] <span style="color:#f92672">/</span> <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">numerators</span>].<span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">ratios</span> = <span style="color:#a6e22e">ratios</span>

    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">generate_diffs</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">df</span>, <span style="color:#a6e22e">left_amounts</span>, <span style="color:#a6e22e">right_amounts</span>):
        <span style="color:#a6e22e">diffs</span> = {}
        <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">left_amount</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">left_amounts</span>:
            <span style="color:#66d9ef">for</span> <span style="color:#a6e22e">right_amount</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">right_amounts</span>:
                <span style="color:#a6e22e">diffs</span>[<span style="color:#a6e22e">f</span><span style="color:#e6db74">&#34;dif_{left_amount}_{right_amount}&#34;</span>] = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">left_amount</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">right_amount</span>]
            <span style="color:#a6e22e">diffs</span>[<span style="color:#a6e22e">f</span><span style="color:#e6db74">&#34;dif_{left_amount}_total&#34;</span>] = <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">left_amount</span>] <span style="color:#f92672">-</span> <span style="color:#a6e22e">df</span>[<span style="color:#a6e22e">right_amounts</span>].<span style="color:#a6e22e">sum</span>(<span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)
        <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">diffs</span> = <span style="color:#a6e22e">diffs</span>

    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">X</span>, <span style="color:#a6e22e">y</span>=<span style="color:#a6e22e">None</span>):
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">self</span>

    <span style="color:#a6e22e">def</span> <span style="color:#a6e22e">transform</span>(<span style="color:#a6e22e">self</span>, <span style="color:#a6e22e">X</span>):
        <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">X</span>.copy()

        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">impute_imp_exp</span>:
            <span style="color:#a6e22e">imp_X_</span> = <span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">select_dtypes</span>(<span style="color:#a6e22e">include</span>=<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">number</span>)
            <span style="color:#a6e22e">cols</span> = <span style="color:#a6e22e">imp_X_</span>.<span style="color:#a6e22e">columns</span>
            <span style="color:#a6e22e">knnimp</span> = <span style="color:#a6e22e">KNNImputer</span>()
            <span style="color:#a6e22e">imp_X_</span> = <span style="color:#a6e22e">knnimp</span>.<span style="color:#a6e22e">fit_transform</span>(<span style="color:#a6e22e">imp_X_</span>)
            <span style="color:#a6e22e">imp_df</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">DataFrame</span>(<span style="color:#a6e22e">imp_X_</span>, <span style="color:#a6e22e">columns</span>=<span style="color:#a6e22e">cols</span>, <span style="color:#a6e22e">index</span>=<span style="color:#a6e22e">X_</span>.<span style="color:#a6e22e">index</span>)[[<span style="color:#e6db74">&#34;import_FR&#34;</span>, <span style="color:#e6db74">&#34;export_FR&#34;</span>]]
            <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;import_FR&#34;</span>] = <span style="color:#a6e22e">imp_df</span>[<span style="color:#e6db74">&#34;import_FR&#34;</span>]
            <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;export_FR&#34;</span>] = <span style="color:#a6e22e">imp_df</span>[<span style="color:#e6db74">&#34;export_FR&#34;</span>]

        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">calculate_ratios</span>:
            <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">generate_ratios</span>(<span style="color:#a6e22e">X</span>, [<span style="color:#e6db74">&#34;fc_nuclear&#34;</span>, <span style="color:#e6db74">&#34;fc_wind&#34;</span>, <span style="color:#e6db74">&#34;fc_solar_pv&#34;</span>, <span style="color:#e6db74">&#34;fc_solar_th&#34;</span>], [<span style="color:#e6db74">&#34;fc_demand&#34;</span>])
            <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">concat</span>([<span style="color:#a6e22e">X_</span>, <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">DataFrame</span>(<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">ratios</span>)], <span style="color:#a6e22e">sort</span>=<span style="color:#a6e22e">False</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)

        <span style="color:#960050;background-color:#1e0010">#</span>         <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">calculate_thermal_gap</span>:
        <span style="color:#960050;background-color:#1e0010">#</span>             <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">generate_thermal_gap</span>(<span style="color:#a6e22e">X</span>)
        <span style="color:#960050;background-color:#1e0010">#</span>             <span style="color:#a6e22e">X_</span>[<span style="color:#e6db74">&#34;thermal_gap&#34;</span>] = <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">thermal_gap</span>
        <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">calculate_diffs</span>:
            <span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">generate_diffs</span>(<span style="color:#a6e22e">X_</span>, [<span style="color:#e6db74">&#34;fc_demand&#34;</span>], [<span style="color:#e6db74">&#34;fc_nuclear&#34;</span>, <span style="color:#e6db74">&#34;fc_wind&#34;</span>, <span style="color:#e6db74">&#34;fc_solar_pv&#34;</span>, <span style="color:#e6db74">&#34;fc_solar_th&#34;</span>])
            <span style="color:#a6e22e">X_</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">concat</span>([<span style="color:#a6e22e">X_</span>, <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">DataFrame</span>(<span style="color:#a6e22e">self</span>.<span style="color:#a6e22e">diffs</span>)], <span style="color:#a6e22e">sort</span>=<span style="color:#a6e22e">False</span>, <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">X_</span>
</code></pre></div></li>
</ul>
<p>Applying the Transformations to our dataframes.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">custom_preprocessing</span> = <span style="color:#a6e22e">make_pipeline</span>(<span style="color:#a6e22e">EnergyEncoder</span>(), <span style="color:#a6e22e">DateEncoder</span>(<span style="color:#a6e22e">ohe_cats</span>=<span style="color:#a6e22e">False</span>))
<span style="color:#a6e22e">transformed_df</span> = <span style="color:#a6e22e">custom_preprocessing</span>.<span style="color:#a6e22e">fit_transform</span>(<span style="color:#a6e22e">X_train</span>, <span style="color:#a6e22e">y_train</span>)
<span style="color:#a6e22e">all_features_df</span> = <span style="color:#a6e22e">pd</span>.<span style="color:#a6e22e">concat</span>([<span style="color:#a6e22e">transformed_df</span>, <span style="color:#a6e22e">y_train</span>], <span style="color:#a6e22e">axis</span>=<span style="color:#ae81ff">1</span>)
</code></pre></div></p>
<p>Since some algorithms perform better with Encoded variables, we will OneHotEncode the variables &ldquo;season&rdquo; and &ldquo;day_period&rdquo;.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">one_hot_season</span> = <span style="color:#a6e22e">ColumnTransformer</span>([(<span style="color:#e6db74">&#34;ohe&#34;</span>, <span style="color:#a6e22e">OneHotEncoder</span>(<span style="color:#a6e22e">sparse</span>=<span style="color:#a6e22e">False</span>, <span style="color:#a6e22e">handle_unknown</span>=<span style="color:#e6db74">&#34;ignore&#34;</span>), [<span style="color:#e6db74">&#34;season&#34;</span>, <span style="color:#e6db74">&#34;day_period&#34;</span>])], <span style="color:#a6e22e">remainder</span>=<span style="color:#e6db74">&#34;passthrough&#34;</span>)
<span style="color:#a6e22e">preprocessing</span> = <span style="color:#a6e22e">make_pipeline</span>(<span style="color:#a6e22e">custom_preprocessing</span>, <span style="color:#a6e22e">one_hot_season</span>)
</code></pre></div></p>
<p><strong>Model Testing</strong></p>
<p>To evaluate the performance of each model we have created a function that plots the real and the predicted output and shows the RMSE.
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">def</span> <span style="color:#a6e22e">evaluate_model</span>(<span style="color:#a6e22e">fitted_model</span>, <span style="color:#a6e22e">X_test</span>, <span style="color:#a6e22e">y_test</span>):
    <span style="color:#a6e22e">y_pred</span> = <span style="color:#a6e22e">fitted_model</span>.<span style="color:#a6e22e">predict</span>(<span style="color:#a6e22e">X_test</span>)
    <span style="color:#a6e22e">fig</span>, <span style="color:#a6e22e">ax</span> = <span style="color:#a6e22e">plt</span>.<span style="color:#a6e22e">subplots</span>()
    <span style="color:#a6e22e">rmse</span> = <span style="color:#a6e22e">mean_squared_error</span>(<span style="color:#a6e22e">y_test</span>, <span style="color:#a6e22e">y_pred</span>, <span style="color:#a6e22e">squared</span>=<span style="color:#a6e22e">False</span>)
    <span style="color:#a6e22e">p1</span> = <span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">y_pred</span>), <span style="color:#a6e22e">max</span>(<span style="color:#a6e22e">y_test</span>))
    <span style="color:#a6e22e">p2</span> = <span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">y_pred</span>), <span style="color:#a6e22e">min</span>(<span style="color:#a6e22e">y_test</span>))
    <span style="color:#a6e22e">fig</span>.<span style="color:#a6e22e">set_size_inches</span>((<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">12</span>))
    <span style="color:#a6e22e">ax</span>.<span style="color:#a6e22e">scatter</span>(<span style="color:#a6e22e">y_test</span>, <span style="color:#a6e22e">y_pred</span>, <span style="color:#a6e22e">s</span>=<span style="color:#ae81ff">2</span>, <span style="color:#a6e22e">c</span>=<span style="color:#a6e22e">np</span>.<span style="color:#a6e22e">absolute</span>(<span style="color:#a6e22e">y_test</span> <span style="color:#f92672">-</span> <span style="color:#a6e22e">y_pred</span>), <span style="color:#a6e22e">cmap</span>=<span style="color:#e6db74">&#34;viridis_r&#34;</span>)
    <span style="color:#a6e22e">ax</span>.<span style="color:#a6e22e">plot</span>([<span style="color:#a6e22e">p1</span>, <span style="color:#a6e22e">p2</span>], [<span style="color:#a6e22e">p1</span>, <span style="color:#a6e22e">p2</span>], <span style="color:#e6db74">&#34;--&#34;</span>, <span style="color:#a6e22e">c</span>=<span style="color:#e6db74">&#34;black&#34;</span>)
    <span style="color:#a6e22e">ax</span>.<span style="color:#a6e22e">set_xlabel</span>(<span style="color:#e6db74">&#34;True Values&#34;</span>, <span style="color:#a6e22e">fontsize</span>=<span style="color:#ae81ff">15</span>)
    <span style="color:#a6e22e">ax</span>.<span style="color:#a6e22e">set_ylabel</span>(<span style="color:#e6db74">&#34;Predictions&#34;</span>, <span style="color:#a6e22e">fontsize</span>=<span style="color:#ae81ff">15</span>)
    <span style="color:#a6e22e">ax</span>.<span style="color:#a6e22e">text</span>(<span style="color:#ae81ff">0.15</span>, <span style="color:#ae81ff">0.85</span>, <span style="color:#a6e22e">f</span><span style="color:#e6db74">&#34;RMSE: {rmse:.2f}&#34;</span>, <span style="color:#a6e22e">horizontalalignment</span>=<span style="color:#e6db74">&#34;left&#34;</span>, <span style="color:#a6e22e">verticalalignment</span>=<span style="color:#e6db74">&#34;top&#34;</span>, <span style="color:#a6e22e">transform</span>=<span style="color:#a6e22e">ax</span>.<span style="color:#a6e22e">transAxes</span>, <span style="color:#a6e22e">fontsize</span>=<span style="color:#e6db74">&#34;large&#34;</span>)
</code></pre></div></p>
<p><em>Linear Regression (Simplest model)</em>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">simple_reg</span> = <span style="color:#a6e22e">Pipeline</span>(
    [
        (<span style="color:#e6db74">&#34;preprocessing&#34;</span>, <span style="color:#a6e22e">simple_preprocessing</span>),
        (<span style="color:#e6db74">&#34;regression&#34;</span>, <span style="color:#a6e22e">LinearRegression</span>()),
    ]
)
<span style="color:#a6e22e">simple_reg</span>.<span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">X_train</span>, <span style="color:#a6e22e">y_train</span>)
</code></pre></div>
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_6.PNG"/> <figcaption>
            <h4>Simple Linear Regression - RMSE=15.90</h4>
        </figcaption>
</figure>
</p>
<p><em>Feature Engineered Linear Regression</em>
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_7.PNG"/> <figcaption>
            <h4>Featured Engineered Linear Regression - RMSE=12.54</h4>
        </figcaption>
</figure>
</p>
<p><em>Feature Engineered Random Forest</em>
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_8.PNG"/> <figcaption>
            <h4>Feature Engineered Random Forest - RMSE=18.64</h4>
        </figcaption>
</figure>
</p>
<p><em>Feature Engineered XGBoost</em>
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_9.PNG"/> <figcaption>
            <h4>Feature Engineered XGBoost - RMSE=17.75</h4>
        </figcaption>
</figure>
</p>
<p><strong>Feature Engineered XGBoost with early Stopping</strong>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">X_xg_train</span>, <span style="color:#a6e22e">X_xg_val</span>, <span style="color:#a6e22e">y_xg_train</span>, <span style="color:#a6e22e">y_xg_val</span> = <span style="color:#a6e22e">train_test_split</span>(
    <span style="color:#a6e22e">X_train</span>, <span style="color:#a6e22e">y_train</span>, <span style="color:#a6e22e">test_size</span>=<span style="color:#a6e22e">test_rows</span>, <span style="color:#a6e22e">shuffle</span>=<span style="color:#a6e22e">False</span>
)  <span style="color:#960050;background-color:#1e0010">#</span> <span style="color:#a6e22e">shuffle</span>:<span style="color:#a6e22e">False</span> <span style="color:#a6e22e">means</span> <span style="color:#a6e22e">it</span> <span style="color:#a6e22e">conserves</span> <span style="color:#a6e22e">first</span> <span style="color:#a6e22e">X</span> <span style="color:#a6e22e">rows</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">train</span> <span style="color:#a6e22e">and</span> <span style="color:#a6e22e">rest</span> <span style="color:#a6e22e">in</span> <span style="color:#a6e22e">test</span>

<span style="color:#a6e22e">X_xg_train_t</span> = <span style="color:#a6e22e">preprocessing</span>.<span style="color:#a6e22e">fit_transform</span>(<span style="color:#a6e22e">X_xg_train</span>)
<span style="color:#a6e22e">X_xg_val_t</span> = <span style="color:#a6e22e">preprocessing</span>.<span style="color:#a6e22e">transform</span>(<span style="color:#a6e22e">X_xg_val</span>)

<span style="color:#a6e22e">xgb_eval_set</span> = [(<span style="color:#a6e22e">X_xg_train_t</span>, <span style="color:#a6e22e">y_xg_train</span>), (<span style="color:#a6e22e">X_xg_val_t</span>, <span style="color:#a6e22e">y_xg_val</span>)]
<span style="color:#a6e22e">xgb_earlystopping_reg</span> = <span style="color:#a6e22e">sklearn</span>.<span style="color:#a6e22e">base</span>.<span style="color:#a6e22e">clone</span>(<span style="color:#a6e22e">feateng_xgb_reg</span>)
<span style="color:#a6e22e">xgb_earlystopping_reg</span>.<span style="color:#a6e22e">set_params</span>(<span style="color:#f92672">**</span>{<span style="color:#e6db74">&#34;xgbregressor__n_estimators&#34;</span>: <span style="color:#ae81ff">10000</span>, <span style="color:#e6db74">&#34;xgbregressor__learning_rate&#34;</span>: <span style="color:#ae81ff">0.01</span>})
<span style="color:#a6e22e">xgb_earlystopping_reg</span>.<span style="color:#a6e22e">fit</span>(<span style="color:#a6e22e">X_xg_train</span>, <span style="color:#a6e22e">y_xg_train</span>, <span style="color:#a6e22e">xgbregressor__eval_set</span>=<span style="color:#a6e22e">xgb_eval_set</span>, <span style="color:#a6e22e">xgbregressor__early_stopping_rounds</span>=<span style="color:#ae81ff">200</span>)

<span style="color:#a6e22e">xgb_earlystopping_reg</span>.<span style="color:#a6e22e">named_steps</span>[<span style="color:#e6db74">&#34;xgbregressor&#34;</span>].<span style="color:#a6e22e">best_ntree_limit</span>
</code></pre></div></p>
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_10.PNG"/> <figcaption>
            <h4>Feature Engineered XGBoost with Early Stopping- RMSE=6.60</h4>
        </figcaption>
</figure>

<p><strong>Selecting the best number of features</strong></p>
<p>Lastly, we checked whether we could improve the accuracy of our model by predicting with less paramaters as a measure to prevent overfitting. However, the result was that the more features, the more accurate our model.</p>
<figure>
    <img src="https://oriolvila.github.io/Oriol_Portfolio/images/Project5_11.PNG"/> <figcaption>
            <h4>Y-axis: Score.  X-axis: Number of parameters</h4>
        </figcaption>
</figure>

<p>Find the code and the datasets here: <a href="https://github.com/OriolVila/Predicting-Energy-Price">https://github.com/OriolVila/Predicting-Energy-Price</a></p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://oriolvila.github.io/Oriol_Portfolio/" >
    &copy;  Oriol 2021 
  </a>
    <div>




<a href="https://twitter.com/Oriol_VilaMasip" target="_blank" class="link-transition twitter link dib z-999 pt3 pt0-l mr1" title="Twitter link" rel="noopener" aria-label="follow on Twitter——Opens in a new window">
  <svg height="32px"  style="enable-background:new 0 0 67 67;" version="1.1" viewBox="0 0 67 67" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M37.167,22.283c-2.619,0.953-4.274,3.411-4.086,6.101  l0.063,1.038l-1.048-0.127c-3.813-0.487-7.145-2.139-9.974-4.915l-1.383-1.377l-0.356,1.017c-0.754,2.267-0.272,4.661,1.299,6.271  c0.838,0.89,0.649,1.017-0.796,0.487c-0.503-0.169-0.943-0.296-0.985-0.233c-0.146,0.149,0.356,2.076,0.754,2.839  c0.545,1.06,1.655,2.097,2.871,2.712l1.027,0.487l-1.215,0.021c-1.173,0-1.215,0.021-1.089,0.467  c0.419,1.377,2.074,2.839,3.918,3.475l1.299,0.444l-1.131,0.678c-1.676,0.976-3.646,1.526-5.616,1.568  C19.775,43.256,19,43.341,19,43.405c0,0.211,2.557,1.397,4.044,1.864c4.463,1.377,9.765,0.783,13.746-1.568  c2.829-1.673,5.657-5,6.978-8.221c0.713-1.716,1.425-4.851,1.425-6.354c0-0.975,0.063-1.102,1.236-2.267  c0.692-0.678,1.341-1.419,1.467-1.631c0.21-0.403,0.188-0.403-0.88-0.043c-1.781,0.636-2.033,0.551-1.152-0.402  c0.649-0.678,1.425-1.907,1.425-2.267c0-0.063-0.314,0.042-0.671,0.233c-0.377,0.212-1.215,0.53-1.844,0.72l-1.131,0.361l-1.027-0.7  c-0.566-0.381-1.361-0.805-1.781-0.932C39.766,21.902,38.131,21.944,37.167,22.283z M33,64C16.432,64,3,50.569,3,34S16.432,4,33,4  s30,13.431,30,30S49.568,64,33,64z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/></svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>




<a href="https://www.linkedin.com/in/oriol-vila-masip/" target="_blank" class="link-transition linkedin link dib z-999 pt3 pt0-l mr1" title="LinkedIn link" rel="noopener" aria-label="follow on LinkedIn——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 65 65;" version="1.1" viewBox="0 0 65 65" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
  <path d="M50.837,48.137V36.425c0-6.275-3.35-9.195-7.816-9.195  c-3.604,0-5.219,1.983-6.119,3.374V27.71h-6.79c0.09,1.917,0,20.427,0,20.427h6.79V36.729c0-0.609,0.044-1.219,0.224-1.655  c0.49-1.22,1.607-2.483,3.482-2.483c2.458,0,3.44,1.873,3.44,4.618v10.929H50.837z M22.959,24.922c2.367,0,3.842-1.57,3.842-3.531  c-0.044-2.003-1.475-3.528-3.797-3.528s-3.841,1.524-3.841,3.528c0,1.961,1.474,3.531,3.753,3.531H22.959z M34,64  C17.432,64,4,50.568,4,34C4,17.431,17.432,4,34,4s30,13.431,30,30C64,50.568,50.568,64,34,64z M26.354,48.137V27.71h-6.789v20.427  H26.354z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>


<a href="https://github.com/OriolVila" target="_blank" class="link-transition github link dib z-999 pt3 pt0-l mr1" title="Github link" rel="noopener" aria-label="follow on Github——Opens in a new window">
  <svg  height="32px"  style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="32px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
  <path d="M256,32C132.3,32,32,134.8,32,261.7c0,101.5,64.2,187.5,153.2,217.9c11.2,2.1,15.3-5,15.3-11.1   c0-5.5-0.2-19.9-0.3-39.1c-62.3,13.9-75.5-30.8-75.5-30.8c-10.2-26.5-24.9-33.6-24.9-33.6c-20.3-14.3,1.5-14,1.5-14   c22.5,1.6,34.3,23.7,34.3,23.7c20,35.1,52.4,25,65.2,19.1c2-14.8,7.8-25,14.2-30.7c-49.7-5.8-102-25.5-102-113.5   c0-25.1,8.7-45.6,23-61.6c-2.3-5.8-10-29.2,2.2-60.8c0,0,18.8-6.2,61.6,23.5c17.9-5.1,37-7.6,56.1-7.7c19,0.1,38.2,2.6,56.1,7.7   c42.8-29.7,61.5-23.5,61.5-23.5c12.2,31.6,4.5,55,2.2,60.8c14.3,16.1,23,36.6,23,61.6c0,88.2-52.4,107.6-102.3,113.3   c8,7.1,15.2,21.1,15.2,42.5c0,30.7-0.3,55.5-0.3,63c0,6.1,4,13.3,15.4,11C415.9,449.1,480,363.1,480,261.7   C480,134.8,379.7,32,256,32z"/>
</svg>

<span class="new-window"><svg  height="8px"  style="enable-background:new 0 0 1000 1000;" version="1.1" viewBox="0 0 1000 1000" width="8px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" >
<path d="M598 128h298v298h-86v-152l-418 418-60-60 418-418h-152v-86zM810 810v-298h86v298c0 46-40 86-86 86h-596c-48 0-86-40-86-86v-596c0-46 38-86 86-86h298v86h-298v596h596z" style="fill-rule:evenodd;clip-rule:evenodd;fill:;"/>
</svg>
</span></a>







</div>
  </div>
</footer>

  </body>
</html>
